# JJZ-Alert v2.0 完整配置示例
# 新架构：Redis缓存 + Apprise多通道推送 + 智能家居集成

# =============================================================================
# 全局配置
# =============================================================================
global:
  # 日志配置
  log:
    level: DEBUG  # DEBUG, INFO, WARNING, ERROR

  # 管理员通知配置（系统错误、状态通知）
  admin:
    notifications:
      - type: apprise
        urls:
          - barks://your-barks-server/your-key
          - tgram://your-bot-token/your-chat-id
          - dingtalk://your-webhook-url/your-secret

  # 消息模板配置（可选，如不配置则使用默认模板）
  # 支持使用 ${变量名} 语法进行变量替换
  message_templates:
    # 有效状态模板
    valid_status: |
      车牌${display_name}的进京证(${jjz_type})状态：${status_text}，有效期${valid_start}至${valid_end}，剩余${days_remaining}天。${sycs_part}
    # 过期状态模板
    expired_status: |
      车牌${display_name}的进京证已过期，请及时续办。${sycs_part}
    # 审核中状态模板
    pending_status: |
      车牌${display_name}的进京证(${jjz_type})状态：审核中，申请时间${apply_time}。请关注审核进度。
    # 错误状态模板
    error_status: |
      车牌${display_name}的进京证(${jjz_type})状态：${status}。${error_msg}
    # 限行提醒前缀模板
    traffic_reminder_prefix: "【⚠️${reminder_text}】"
    # 六环内剩余次数部分模板
    sycs_part: "六环内进京证剩余${sycs}次。"
    # 自定义模板示例（可以根据需要添加更多模板）
    # custom_template: "自定义消息：${variable1} 和 ${variable2}"

  # 定时提醒配置
  remind:
    enable: true
    times: ["07:00", "12:30", "19:00", "23:55"]  # 推送时机
    api:
      enable: true
      host: "0.0.0.0"
      port: 8000

  # Redis数据缓存配置
  redis:
    host: localhost
    port: 6379
    db: 0
    # password: "your_redis_password"  # 如果设置了密码
    # connection_pool_size: 10

  # 缓存策略配置
  cache:
    push_history_ttl: 2592000  # 推送历史缓存30天
    # 注意：进京证数据每次运行主流程时都重新查询，缓存数据仅供推送和后续操作使用
    # 限行规则默认缓存到当天24:00

  # Home Assistant集成配置（可选）
  homeassistant:
    enabled: false
    # 二选一集成模式：rest 或 mqtt（默认 rest）
    integration_mode: mqtt

    # ========== 当使用 REST 模式时，仅需配置以下关键参数 ==========
    rest_url: "http://homeassistant.local:8123"
    rest_token: "your_long_lived_access_token_here"
    # entity_prefix: "jjz_alert"  # 实体前缀，默认值为 jjz_alert
    # device_manufacturer: "进京证提醒" # 设备生产商，默认值为 进京证提醒
    # device_model: "jjz_alert" #设备型号，默认值为 jjz_alert
    # 其他 REST 细节（如 retry/timeout 等）已内置默认值，不建议修改

    # ========== 当使用 MQTT 模式时，需配置以下参数 ==========
    mqtt_host: "homeassistant.local"    # 你的 MQTT Broker 地址（HA 插件一般是 HA 主机IP）
    mqtt_port: 1883
    mqtt_username: "ha"
    mqtt_password: "your_password"
    # 其他 MQTT 细节（如 client_id/base_topic 等）已内置默认值，不建议修改

# =============================================================================
# 进京证账户配置（数据来源）
# =============================================================================
jjz_accounts:
  - name: "张三账户"
    jjz:
      token: "your_jjz_token_1_here"
      url: "https://jjz.jtgl.beijing.gov.cn:2443/pro/applyRecordController/stateList"
  
  - name: "李四账户"
    jjz:
      token: "your_jjz_token_2_here"
      url: "https://jjz.jtgl.beijing.gov.cn:1443/pro/applyRecordController/stateList"

# =============================================================================
# 车牌配置（推送目标）
# =============================================================================
plates:
  # 示例1：Apprise多通道推送（推荐）- 使用变量占位符
  - plate: "京C11111"
    display_name: "智能家居车辆"
    icon: "https://example.com/smart_car_icon.png"
    notifications:
      - type: apprise
        urls:
          - "barks://api.day.app/device_key?level={level}&group={plate}&icon={icon}"  # Bark with placeholders
          - "tgram://bot_token/chat_id"           # Telegram
          - "mailto://user:pass@gmail.com"        # 邮件
          - "wxwork://webhook_key"                # 企业微信
          - "dingding://token/secret"             # 钉钉
          - "json://your-webhook-url.com/notify"  # 自定义Webhook

  # 示例2：Apprise多通道推送 - 完整配置
  - plate: "京D22222"
    display_name: "公司车辆"
    icon: "https://example.com/company_car_icon.png"
    notifications:
      - type: apprise
        urls:
          - "tgram://bot_token/company_group"     # 公司群组
          - "mailto://fleet@company.com"          # 车队邮箱


  # 示例3：多个Apprise配置（不同用途）
  - plate: "京E33333"
    display_name: "家庭用车"
    icon: "https://example.com/family_car_icon.png"
    notifications:
      # 家庭成员通知
      - type: apprise
        urls:
          - "tgram://bot_token/family_group"
          - "barks://api.day.app/dad_device?level={level}&group={plate}&icon={icon}"
          - "barks://api.day.app/mom_device?level={level}&group={plate}&icon={icon}"

      
      # 管理通知
      - type: apprise
        urls:
          - "mailto://family-admin@example.com"
